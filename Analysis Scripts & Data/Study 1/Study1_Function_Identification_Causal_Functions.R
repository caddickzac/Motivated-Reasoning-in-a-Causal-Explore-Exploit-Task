#---------------------------------------------------------------------

Study1_Function_Identification_Causal_Functions <- select(SA_F1_4, User, Function, Ambiguity, Congruence, Plot_Match_Scored)
names(Study1_Function_Identification_Causal_Functions) <- c("Participant", "Function", "Ambiguity", "Congruence", "Plot_Match_Scored")
write.csv(Study1_Function_Identification_Causal_Functions, "Study1_Function_Identification_Causal_Functions.csv")

########################################################################
# github code below
########################################################################

#import libraries
library("tidyverse")
library("lmerTest")

# import data
Study1_Function_Identification_Causal_Functions <- as_tibble(read.csv("Study1_Function_Identification_Causal_Functions.csv"))

# Preview data
head(Study1_Function_Identification_Causal_Functions)

#############################################
# Function Identification: Causal Functions #
#############################################

# Setup variables for analysis
Study1_Function_Identification_Causal_Functions$Ambiguity <- as.factor(Study1_Function_Identification_Causal_Functions$Ambiguity)
Study1_Function_Identification_Causal_Functions$Congruence <- as.factor(Study1_Function_Identification_Causal_Functions$Congruence)
Study1_Function_Identification_Causal_Functions$Plot_Match_Scored <- as.factor(Study1_Function_Identification_Causal_Functions$Plot_Match_Scored)

# Effects Coding
Study1_Function_Identification_Causal_Functions$Congruence2 <- ifelse(Study1_Function_Identification_Causal_Functions$Congruence==1,.5,-.5)
Study1_Function_Identification_Causal_Functions$Ambiguity2 <- ifelse(Study1_Function_Identification_Causal_Functions$Ambiguity=="Low",.5,-.5)

# m1 <- glmer(Plot_Match_Scored ~ Ambiguity2*Congruence2 + (1+Ambiguity2*Congruence2|Participant), 
#             data=Study1_Function_Identification_Causal_Functions, family="binomial")
# summary(m1)
# Model failed to converge with max|grad| = 0.304361 (tol = 0.001, component 1)

# mixed effects logistic regression analysis 
m2 <- glmer(Plot_Match_Scored ~ Ambiguity2*Congruence2 + (1+Ambiguity2*Congruence2||Participant), 
            data=Study1_Function_Identification_Causal_Functions, family="binomial")
summary(m2)
beep(2)

# Generalized linear mixed model fit by maximum likelihood (Laplace Approximation) ['glmerMod']
# Family: binomial  ( logit )
# Formula: Plot_Match_Scored ~ Ambiguity2 * Congruence2 + (1 + Ambiguity2 *      Congruence2 || User)
# Data: Study1_Function_Identification_Causal_Functions
# 
# AIC      BIC   logLik deviance df.resid 
# 174.4    199.2    -79.2    158.4      156 
# 
# Scaled residuals: 
#   Min      1Q  Median      3Q     Max 
# -0.8339 -0.5651 -0.3491 -0.2651  3.5578 
# 
# Random effects:
#   Groups Name                   Variance  Std.Dev. 
# User   (Intercept)            0.000e+00 0.000e+00
# User.1 Ambiguity2             1.422e-10 1.192e-05
# User.2 Congruence2            1.700e-09 4.123e-05
# User.3 Ambiguity2:Congruence2 4.124e+00 2.031e+00
# Number of obs: 164, groups:  User, 41
# 
# Fixed effects:
#   Estimate Std. Error z value Pr(>|z|)    
# (Intercept)            -1.48096    0.25074  -5.906  3.5e-09 ***
#   Ambiguity2              1.48172    0.45993   3.222  0.00127 ** 
#   Congruence2             0.01537    0.44988   0.034  0.97274    
# Ambiguity2:Congruence2  1.14696    0.95361   1.203  0.22907    
# ---
#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
# 
# Correlation of Fixed Effects:
#   (Intr) Ambgt2 Cngrn2
# Ambiguity2  -0.416              
# Congruence2  0.151 -0.198       
# Ambgty2:Cn2 -0.213  0.204 -0.378

