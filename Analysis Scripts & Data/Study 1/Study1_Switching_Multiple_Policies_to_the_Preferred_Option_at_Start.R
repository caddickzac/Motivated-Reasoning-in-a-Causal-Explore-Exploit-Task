####################################################################################
# Switching Multiple Policies to the Preferred Option at the Beginning of Learning #
####################################################################################

# Import Libraries
library("tidyverse")

# Import data
Switching_Multiple_Policies_to_the_Preferred_Option_at_Start <- tibble(read.csv("Study1_Switching_Multiple_Policies_to_the_Preferred_Option_at_Start.csv"))

# preview data
head(Switching_Multiple_Policies_to_the_Preferred_Option_at_Start)

# data dictionary:
## "Participant" = participant number
## "Trial" = trial number (range: 11-150; only includes trials which participant had control of policies decisions)
## "Function" = Function number (range 1-6; refer to payoff function figure) 
## "Confounded_Testing" = denotes if function/policy test was controlled (coded as 0; no other tests co-occurring) or confounded (coded as 1; two or more tests occurring at same time)
## "Switched_to_Preferred" = denotes if function/policy test was to preferred policy (1=change to preferred policy; 0=change to non-preferred policy)

# new variables:
## trial_adj is reflective of when participants actually had control of the economic system. 
Switching_Multiple_Policies_to_the_Preferred_Option_at_Start$Trial_adj <- Switching_Multiple_Policies_to_the_Preferred_Option_at_Start$Trial-10

## Code trial to examine behavior on first trial (1) versus all other trials (2)
Switching_Multiple_Policies_to_the_Preferred_Option_at_Start$Trial_coded <- ifelse(Switching_Multiple_Policies_to_the_Preferred_Option_at_Start$Trial_adj==1,1,2)

#-----------------------------------------------------------------------------------------------------------------------

#############################################################################
# descriptive statistics for "Table 1. Counts of Testing Instances by Type" #
#############################################################################

# was confounded testing different on the first trial versus other trials?
aggregate(Switching_Multiple_Policies_to_the_Preferred_Option_at_Start$Confounded_Testing, 
          by=list(Switching_Multiple_Policies_to_the_Preferred_Option_at_Start$Trial_coded,
                  Switching_Multiple_Policies_to_the_Preferred_Option_at_Start$Switched_to_Preferred), 
          sum) %>% 
  rename("Trial_Coded"=Group.1,
         "Switched_to_Preferred"=Group.2,
         "Confounded_Testing_Count"=x) %>% 
  arrange(Trial_Coded)

# was there a difference in single policy (controlled) testing by preference and across first and latter trials
single_tests_only <- Switching_Multiple_Policies_to_the_Preferred_Option_at_Start %>% 
  filter(Confounded_Testing==0)

aggregate(single_tests_only$Confounded_Testing, 
          by=list(single_tests_only$Switched_to_Preferred, 
                  single_tests_only$Trial_coded),
          length) %>% 
  rename("Switched_to_Preferred"=Group.1,
         "Trial_coded"=Group.2,
         "Non_Confounded_Testing_Count"=x)

#-----------------------------------------------------------------------------------------------------------------------

###############################################################################################
# data used for "Figure 4. Number of controlled and confounded changes to policies per trial" #
###############################################################################################

# create two dataframes examining 1) confounded testing and 2) single-policy testing
conf_test <- aggregate(Switching_Multiple_Policies_to_the_Preferred_Option_at_Start$Confounded_Testing, by=list(Switching_Multiple_Policies_to_the_Preferred_Option_at_Start$Trial_adj), sum) 
single_test <- aggregate(single_tests_only$Confounded_Testing, by=list(single_tests_only$Trial_adj), length)

# stack the two above dataframes
Test_Type <- c(rep("Confounded", length(conf_test$Group.1)),
               rep("Controlled", length(single_test$Group.1)))
Trial <- c(conf_test$Group.1, single_test$Group.1)
Counts <- c(conf_test$x, single_test$x)
Number_of_controlled_and_confounded_changes_by_per_trial <- tibble(Test_Type, Trial, Counts)


ggplot(data=Number_of_controlled_and_confounded_changes_by_per_trial, aes(x=Trial, y=Counts, group=Test_Type)) + 
  geom_line(aes(color=Test_Type)) +
  scale_color_manual(values = c("#BFBFBF", "black")) +
  scale_x_continuous(limits=c(0,140), breaks=c(0, 20,40,60,80,100,120, 140)) +
  labs(x='Trial') +
  theme_bw() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    strip.text.x = element_text(size = 10, color='black'),
    axis.text.y = element_text(size = 10, color='black'),
    axis.text.x = element_text(size = 10, color='black')
  )

#-----------------------------------------------------------------------------------------------------------------------
