#############################################
# Function Identification: Causal Functions #
#############################################

#import libraries
library("tidyverse")
library("lmerTest")

# import data
Study3_Function_Identification_Causal_Functions <- as_tibble(read.csv("Study3_Function_Identification_Causal_Functions.csv"))

# Preview data
head(Study3_Function_Identification_Causal_Functions)

# data dictionary:
## "Participant" = participant number
## "Function_Exposure_Treatment" = denotes whether or not participant received function exposure treatment (see Study 3 method section for details;), 0=no, 1=yes
## "Function" = function number (causal functions only; range 1-4; refer to payoff function figure)
## "Ambiguity" = denotes ambiguity of function (low vs high)
## "Congruence" = denotes preference-congruence for a given policy/function, 1=yes, -1=no (i.e., is preferred policy actually the best policy)
## "Plot_Match_Scored" = denotes whether or not a participant correctly identified the plot/figure the corresponds to a given function (1=yes, 0=no) 

##################################################
# Preference-Congruence vs Incongruence Analysis #
##################################################

# Effects coding for model
Study3_Function_Identification_Causal_Functions$Ambiguity2 <-
  ifelse(Study3_Function_Identification_Causal_Functions$Ambiguity=="Low",.5,-.5)

Study3_Function_Identification_Causal_Functions$Congruence2 <-
  ifelse(Study3_Function_Identification_Causal_Functions$Congruence=="Congruent",.5,-.5)

Study3_Function_Identification_Causal_Functions$Function_Exposure_Treatment2 <-
  ifelse(Study3_Function_Identification_Causal_Functions$Function_Exposure_Treatment==1,.5,-.5)


# convergence issues prior to settling on this model
m <- glmer(Plot_Match_Scored ~ Congruence2*Ambiguity2*Function_Exposure_Treatment2 + (1|Participant),
            data=Study3_Function_Identification_Causal_Functions, family="binomial")
summary(m)

# Generalized linear mixed model fit by maximum likelihood (Laplace Approximation) ['glmerMod']
# Family: binomial  ( logit )
# Formula: Plot_Match_Scored ~ Congruence2 * Ambiguity2 * Function_Exposure_Treatment2 +      (1 | Participant)
# Data: Study3_Function_Identification_Causal_Functions
# 
# AIC      BIC   logLik deviance df.resid 
# 306.7    340.0   -144.4    288.7      291 
# 
# Scaled residuals: 
#   Min      1Q  Median      3Q     Max 
# -0.9261 -0.5236 -0.4109 -0.2255  4.2699 
# 
# Random effects:
#   Groups      Name        Variance Std.Dev.
# Participant (Intercept) 0.07846  0.2801  
# Number of obs: 300, groups:  Participant, 78
# 
# Fixed effects:
#   Estimate Std. Error z value Pr(>|z|)    
# (Intercept)                                          -1.4663     0.1906  -7.692 1.45e-14 ***
#   Congruence2                                           0.6754     0.3288   2.054  0.03998 *  
#   Ambiguity2                                            1.0893     0.3319   3.283  0.00103 ** 
#   Function_Exposure_Treatment2                          0.5208     0.3353   1.553  0.12039    
# Congruence2:Ambiguity2                               -0.1642     0.6553  -0.251  0.80219    
# Congruence2:Function_Exposure_Treatment2             -0.6879     0.6553  -1.050  0.29385    
# Ambiguity2:Function_Exposure_Treatment2               0.4088     0.6565   0.623  0.53352    
# Congruence2:Ambiguity2:Function_Exposure_Treatment2   1.6543     1.3117   1.261  0.20724    
# ---
#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
